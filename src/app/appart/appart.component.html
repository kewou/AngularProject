<section class="units">
  <div class="units__bar">
    <h1 class="units__title">
      Les logements du bien : {{ descriptionLogement }}
    </h1>

    <div class="units__actions">
      <button mat-stroked-button class="btn-back" (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
        Retour
      </button>

      <button
        mat-raised-button
        color="primary"
        class="btn-primary"
        (click)="openAddAppartDialog()"
      >
        ➕ Ajouter un appartement
      </button>
    </div>
  </div>

  <ng-container *ngIf="apparts?.length; else noApparts">
    <div class="units__grid">
      <article class="unit-card" *ngFor="let appart of apparts">
        <header class="unit-card__head" (click)="viewLoyers(appart.reference)">
          <div class="unit-card__title">
            <h3>{{ appart.nom }}</h3>
          </div>

          <!-- menu -->
          <button
            mat-icon-button
            class="unit-card__menu"
            [matMenuTriggerFor]="menu"
            (click)="$event.stopPropagation()"
            aria-label="Actions appartement"
          >
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button
              *ngIf="!hasBailActif(appart)"
              mat-menu-item
              (click)="openAddBailDialog(appart.reference)"
            >
              <mat-icon>person_add</mat-icon>
              <span>Assigner un locataire</span>
            </button>

            <button mat-menu-item (click)="viewLoyers(appart.reference)">
              <mat-icon>history</mat-icon>
              <span>Historique</span>
            </button>

            <button mat-menu-item (click)="openEditAppartDialog(appart)">
              <mat-icon>edit</mat-icon>
              <span>Modifier</span>
            </button>

            <button
              *ngIf="hasBailActif(appart)"
              mat-menu-item
              (click)="
                sortirLocataire(appart.reference, getBailActifId(appart))
              "
            >
              <mat-icon>logout</mat-icon>
              <span>Sortir le locataire</span>
            </button>

            <button
              mat-menu-item
              class="menu-danger"
              (click)="openDeleteAppartDialog(appart.reference)"
            >
              <mat-icon>delete</mat-icon>
              <span>Supprimer</span>
            </button>
          </mat-menu>
        </header>

        <div class="unit-card__content" (click)="viewLoyers(appart.reference)">
          <ng-container *ngIf="getBailActif(appart) as bail; else vacant">
            <div class="tenant-info">
              <p>
                <mat-icon inline>person</mat-icon>
                <strong>{{ bail.locataire.name }}</strong>
              </p>
              <p class="muted">
                Entrée le {{ bail.dateEntree | date: "dd/MM/yyyy" }}
              </p>
            </div>
          </ng-container>

          <ng-template #vacant>
            <p class="muted">
              <mat-icon inline>home</mat-icon>
              Appartement libre
            </p>
          </ng-template>
        </div>

        <div class="price-badges">
          <span class="badge">
            Loyer&nbsp;: <strong>{{ appart.prixLoyer }} </strong>
          </span>
          <span class="badge badge--muted">
            Caution&nbsp;: <strong>{{ appart.prixCaution }} </strong>
          </span>
        </div>

        <footer class="unit-card__footer">
          <button
            mat-stroked-button
            color="primary"
            (click)="viewLoyers(appart.reference)"
          >
            Ouvrir
          </button>
          <div class="unit-card__actions">
            <button mat-button (click)="openEditAppartDialog(appart)">
              Modifier
            </button>
            <button
              mat-button
              class="text-danger"
              (click)="openDeleteAppartDialog(appart.reference)"
            >
              Supprimer
            </button>
          </div>
        </footer>
      </article>
    </div>
  </ng-container>

  <ng-template #noApparts>
    <div class="units-empty">
      <h3>Aucun appartement trouvé pour ce bien</h3>
      <p>Ajoutez votre premier appartement pour démarrer le suivi.</p>
      <button
        mat-raised-button
        color="primary"
        class="btn-primary"
        (click)="openAddAppartDialog()"
      >
        ➕ Ajouter un appartement
      </button>
    </div>
  </ng-template>
</section>
